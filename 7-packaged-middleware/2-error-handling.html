
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Error Handling · Slim Portal</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="nuxseme">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="3-method-overriding.html" />
    
    
    <link rel="prev" href="1-routing.html" />
    

    
        <link rel="shortcut icon" href='../assets/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../assets/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../assets/favicon.ico'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../assets/favicon.png">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon.png">
        
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"nuxseme","repo":"slim-portal","type":"star","size":"small","count":true}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Get Started
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../1-get-started/1-home.html">
            
                <a href="../1-get-started/1-home.html">
            
                    
                    Home
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../1-get-started/2-installtion.html">
            
                <a href="../1-get-started/2-installtion.html">
            
                    
                    Installtion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../1-get-started/3-web-servers.html">
            
                <a href="../1-get-started/3-web-servers.html">
            
                    
                    Web Servers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../1-get-started/4-deployment.html">
            
                <a href="../1-get-started/4-deployment.html">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Concepts
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../2-concepts/1-application-life-cycle.html">
            
                <a href="../2-concepts/1-application-life-cycle.html">
            
                    
                    Application Life Cycle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../2-concepts/2-psr-7.html">
            
                <a href="../2-concepts/2-psr-7.html">
            
                    
                    Psr 7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../2-concepts/3-middleware.html">
            
                <a href="../2-concepts/3-middleware.html">
            
                    
                    Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../2-concepts/4-dependency-container.html">
            
                <a href="../2-concepts/4-dependency-container.html">
            
                    
                    Dependency Container
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Application
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../3-application/1-overview.html">
            
                <a href="../3-application/1-overview.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../3-application/2-notices-warings-handling.html">
            
                <a href="../3-application/2-notices-warings-handling.html">
            
                    
                    Notices Warings Handling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Request
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../4-request/1-overview.html">
            
                <a href="../4-request/1-overview.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../4-request/2-method.html">
            
                <a href="../4-request/2-method.html">
            
                    
                    Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../4-request/3-headers.html">
            
                <a href="../4-request/3-headers.html">
            
                    
                    Headers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../4-request/4-body.html">
            
                <a href="../4-request/4-body.html">
            
                    
                    Body
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../4-request/5-uploaded-files.html">
            
                <a href="../4-request/5-uploaded-files.html">
            
                    
                    Uploaded Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../4-request/6-helpers.html">
            
                <a href="../4-request/6-helpers.html">
            
                    
                    Helpers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../4-request/7-route-object.html">
            
                <a href="../4-request/7-route-object.html">
            
                    
                    Route Object
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Response
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../5-response/1-overview.html">
            
                <a href="../5-response/1-overview.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../5-response/2-status.html">
            
                <a href="../5-response/2-status.html">
            
                    
                    Status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../5-response/3-headers.html">
            
                <a href="../5-response/3-headers.html">
            
                    
                    Headers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../5-response/4-body.html">
            
                <a href="../5-response/4-body.html">
            
                    
                    Body
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../5-response/5-json.html">
            
                <a href="../5-response/5-json.html">
            
                    
                    Json
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Routing
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../6-routing/1-overview.html">
            
                <a href="../6-routing/1-overview.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../6-routing/2-create-routes.html">
            
                <a href="../6-routing/2-create-routes.html">
            
                    
                    Create Routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../6-routing/3-callbacks.html">
            
                <a href="../6-routing/3-callbacks.html">
            
                    
                    Callbacks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../6-routing/4-strategies.html">
            
                <a href="../6-routing/4-strategies.html">
            
                    
                    Strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../6-routing/5-placeholders.html">
            
                <a href="../6-routing/5-placeholders.html">
            
                    
                    Placeholders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../6-routing/6-names.html">
            
                <a href="../6-routing/6-names.html">
            
                    
                    Names
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../6-routing/7-groups.html">
            
                <a href="../6-routing/7-groups.html">
            
                    
                    Groups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../6-routing/8-middleware.html">
            
                <a href="../6-routing/8-middleware.html">
            
                    
                    Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../6-routing/9-caching.html">
            
                <a href="../6-routing/9-caching.html">
            
                    
                    Caching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../6-routing/10-container-resolution.html">
            
                <a href="../6-routing/10-container-resolution.html">
            
                    
                    Container Resolution
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Packaged Middleware
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="1-routing.html">
            
                <a href="1-routing.html">
            
                    
                    Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.2" data-path="2-error-handling.html">
            
                <a href="2-error-handling.html">
            
                    
                    Error Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="3-method-overriding.html">
            
                <a href="3-method-overriding.html">
            
                    
                    Method Overriding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="4-output-buffering.html">
            
                <a href="4-output-buffering.html">
            
                    
                    Output Buffering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="5-body-parsing.html">
            
                <a href="5-body-parsing.html">
            
                    
                    Body Parsing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="6-content-length.html">
            
                <a href="6-content-length.html">
            
                    
                    Content Length
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Cook Book
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../8-cook-book/1-trailing-in-routes.html">
            
                <a href="../8-cook-book/1-trailing-in-routes.html">
            
                    
                    Trailing In Routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../8-cook-book/2-retrieving-current-route.html">
            
                <a href="../8-cook-book/2-retrieving-current-route.html">
            
                    
                    Retrieving Current Route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../8-cook-book/3-enabling-cors.html">
            
                <a href="../8-cook-book/3-enabling-cors.html">
            
                    
                    Enabling Cors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../8-cook-book/4-uploading-files-using-post-forms.html">
            
                <a href="../8-cook-book/4-uploading-files-using-post-forms.html">
            
                    
                    Uploading Files Using Post Forms
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    Source Code
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../9-source-code/1-catalogue.html">
            
                <a href="../9-source-code/1-catalogue.html">
            
                    
                    Catalogue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../9-source-code/2-autoload.html">
            
                <a href="../9-source-code/2-autoload.html">
            
                    
                    Autoload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../9-source-code/3-index.html">
            
                <a href="../9-source-code/3-index.html">
            
                    
                    Index
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../9-source-code/4-repository.html">
            
                <a href="../9-source-code/4-repository.html">
            
                    
                    Repository
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../9-source-code/5-logger.html">
            
                <a href="../9-source-code/5-logger.html">
            
                    
                    Logger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../9-source-code/6-route.html">
            
                <a href="../9-source-code/6-route.html">
            
                    
                    Route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../9-source-code/7-middleware.html">
            
                <a href="../9-source-code/7-middleware.html">
            
                    
                    Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../9-source-code/8-container.html">
            
                <a href="../9-source-code/8-container.html">
            
                    
                    Container
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="../9-source-code/9-example.html">
            
                <a href="../9-source-code/9-example.html">
            
                    
                    Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="../9-source-code/10-summary.html">
            
                <a href="../9-source-code/10-summary.html">
            
                    
                    Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Error Handling</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#error-handling-middleware"><b></b>Error Handling Middleware</a></li><ul><li><span class="title-icon "></span><a href="#usage"><b></b>Usage</a></li><li><span class="title-icon "></span><a href="#adding-custom-error-handlers"><b></b>Adding Custom Error Handlers</a></li><li><span class="title-icon "></span><a href="#error-logging"><b></b>Error Logging</a></li><li><span class="title-icon "></span><a href="#error-handlingrendering"><b></b>Error Handling/Rendering</a></li><ul><li><span class="title-icon "></span><a href="#force-a-specific-content-type-for-error-rendering"><b></b>Force a specific content type for error rendering</a></li></ul><li><span class="title-icon "></span><a href="#new-http-exceptions"><b></b>New HTTP Exceptions</a></li></ul></ul></div><a href="#error-handling-middleware" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="error-handling-middleware"><a name="error-handling-middleware" class="anchor-navigation-ex-anchor" href="#error-handling-middleware"><i class="fa fa-link" aria-hidden="true"></i></a><a name="error-handling-middleware" class="plugin-anchor" href="#error-handling-middleware"><i class="fa fa-link" aria-hidden="true"></i></a>Error Handling Middleware</h1>
<p>Things go wrong. You can&#x2019;t predict errors, but you can anticipate them. Each Slim Framework application has an error handler that receives all uncaught PHP exceptions. This error handler also receives the current HTTP request and response objects, too. The error handler must prepare and return an appropriate Response object to be returned to the HTTP client.</p>
<h2 id="usage"><a name="usage" class="anchor-navigation-ex-anchor" href="#usage"><i class="fa fa-link" aria-hidden="true"></i></a><a name="usage" class="plugin-anchor" href="#usage"><i class="fa fa-link" aria-hidden="true"></i></a>Usage</h2>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Factory</span>\<span class="hljs-title">AppFactory</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&apos;/../vendor/autoload.php&apos;</span>;

$app = AppFactory::create();

<span class="hljs-comment">/**
 * The routing middleware should be added earlier than the ErrorMiddleware
 * Otherwise exceptions thrown from it will not be handled by the middleware
 */</span>
$app-&gt;addRoutingMiddleware();

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> bool $displayErrorDetails -&gt; Should be set to false in production
 * <span class="hljs-doctag">@param</span> bool $logErrors -&gt; Parameter is passed to the default ErrorHandler
 * <span class="hljs-doctag">@param</span> bool $logErrorDetails -&gt; Display error details in error log
 * which can be replaced by a callable of your choice.
 * <span class="hljs-doctag">@param</span> \Psr\Log\LoggerInterface $logger -&gt; Optional PSR-3 logger to receive errors
 * 
 * <span class="hljs-doctag">Note:</span> This middleware should be added last. It will not handle any exceptions/errors
 * for middleware added after it.
 */</span>
$errorMiddleware = $app-&gt;addErrorMiddleware(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, $logger);

<span class="hljs-comment">// ...</span>

$app-&gt;run();
</code></pre>
<h2 id="adding-custom-error-handlers"><a name="adding-custom-error-handlers" class="anchor-navigation-ex-anchor" href="#adding-custom-error-handlers"><i class="fa fa-link" aria-hidden="true"></i></a><a name="adding-custom-error-handlers" class="plugin-anchor" href="#adding-custom-error-handlers"><i class="fa fa-link" aria-hidden="true"></i></a>Adding Custom Error Handlers</h2>
<p>You can now map custom handlers for any type of Exception or Throwable.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Message</span>\<span class="hljs-title">ServerRequestInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Psr</span>\<span class="hljs-title">Log</span>\<span class="hljs-title">LoggerInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Factory</span>\<span class="hljs-title">AppFactory</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Psr7</span>\<span class="hljs-title">Response</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&apos;/../vendor/autoload.php&apos;</span>;

$app = AppFactory::create();

<span class="hljs-comment">// Add Routing Middleware</span>
$app-&gt;addRoutingMiddleware();

<span class="hljs-comment">// Define Custom Error Handler</span>
$customErrorHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
    ServerRequestInterface $request,
    Throwable $exception,
    bool $displayErrorDetails,
    bool $logErrors,
    bool $logErrorDetails,
    ?LoggerInterface $logger = null
)</span> <span class="hljs-title">use</span> <span class="hljs-params">($app)</span> </span>{
    $logger-&gt;error($exception-&gt;getMessage());

    $payload = [<span class="hljs-string">&apos;error&apos;</span> =&gt; $exception-&gt;getMessage()];

    $response = $app-&gt;getResponseFactory()-&gt;createResponse();
    $response-&gt;getBody()-&gt;write(
        json_encode($payload, JSON_UNESCAPED_UNICODE)
    );

    <span class="hljs-keyword">return</span> $response;
};

<span class="hljs-comment">// Add Error Middleware</span>
$errorMiddleware = $app-&gt;addErrorMiddleware(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, $logger);
$errorMiddleware-&gt;setDefaultErrorHandler($customErrorHandler);

<span class="hljs-comment">// ...</span>

$app-&gt;run();
</code></pre>
<h2 id="error-logging"><a name="error-logging" class="anchor-navigation-ex-anchor" href="#error-logging"><i class="fa fa-link" aria-hidden="true"></i></a><a name="error-logging" class="plugin-anchor" href="#error-logging"><i class="fa fa-link" aria-hidden="true"></i></a>Error Logging</h2>
<p>If you would like to pipe in custom error logging to the default <code>ErrorHandler</code> that ships with Slim, there are two ways to do it.</p>
<p>With the first method, you can simply extend <code>ErrorHandler</code> and stub the <code>logError()</code> method.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">MyApp</span>\<span class="hljs-title">Handlers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Handlers</span>\<span class="hljs-title">ErrorHandler</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyErrorHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ErrorHandler</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logError</span><span class="hljs-params">(string $error)</span>: <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-comment">// Insert custom error logging function.</span>
    }
}
<span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">MyApp</span>\<span class="hljs-title">Handlers</span>\<span class="hljs-title">MyErrorHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Factory</span>\<span class="hljs-title">AppFactory</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&apos;/../vendor/autoload.php&apos;</span>;

$app = AppFactory::create();

<span class="hljs-comment">// Add Routing Middleware</span>
$app-&gt;addRoutingMiddleware();

<span class="hljs-comment">// Instantiate Your Custom Error Handler</span>
$myErrorHandler = <span class="hljs-keyword">new</span> MyErrorHandler($app-&gt;getCallableResolver(), $app-&gt;getResponseFactory());

<span class="hljs-comment">// Add Error Middleware</span>
$errorMiddleware = $app-&gt;addErrorMiddleware(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>);
$errorMiddleware-&gt;setDefaultErrorHandler($myErrorHandler);

<span class="hljs-comment">// ...</span>

$app-&gt;run();
</code></pre>
<p>With the second method, you can supply a logger that conforms to the <a href="https://www.php-fig.org/psr/psr-3/" target="_blank">PSR-3 standard</a>, such as one from the popular <a href="https://github.com/Seldaek/monolog/" target="_blank">Monolog</a> library.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">MyApp</span>\<span class="hljs-title">Handlers</span>\<span class="hljs-title">MyErrorHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Factory</span>\<span class="hljs-title">AppFactory</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&apos;/../vendor/autoload.php&apos;</span>;

$app = AppFactory::create();

<span class="hljs-comment">// Add Routing Middleware</span>
$app-&gt;addRoutingMiddleware();

<span class="hljs-comment">// Instantiate Logger</span>
<span class="hljs-comment">// $logger = ...</span>

<span class="hljs-comment">// Add Error Middleware with Logger</span>
$errorMiddleware = $app-&gt;addErrorMiddleware(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, $logger);

<span class="hljs-comment">// ...</span>

$app-&gt;run();
</code></pre>
<h2 id="error-handlingrendering"><a name="error-handlingrendering" class="anchor-navigation-ex-anchor" href="#error-handlingrendering"><i class="fa fa-link" aria-hidden="true"></i></a><a name="error-handlingrendering" class="plugin-anchor" href="#error-handlingrendering"><i class="fa fa-link" aria-hidden="true"></i></a>Error Handling/Rendering</h2>
<p>The rendering is finally decoupled from the handling. It will still detect the content-type and render things appropriately with the help of <code>ErrorRenderers</code>. The core <code>ErrorHandler</code> extends the <code>AbstractErrorHandler</code> class which has been completely refactored. By default it will call the appropriate <code>ErrorRenderer</code> for the supported content types. The core <code>ErrorHandler</code> defines renderers for the following content types:</p>
<ul>
<li><code>application/json</code></li>
<li><code>application/xml</code> and <code>text/xml</code></li>
<li><code>text/html</code></li>
<li><code>text/plain</code></li>
</ul>
<p>For any content type you can register your own error renderer. So first define a new error renderer that implements <code>\Slim\Interfaces\ErrorRendererInterface</code>.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Interfaces</span>\<span class="hljs-title">ErrorRendererInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCustomErrorRenderer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ErrorRendererInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span><span class="hljs-params">(Throwable $exception, bool $displayErrorDetails)</span>: <span class="hljs-title">string</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;My awesome format&apos;</span>;
    }
}
</code></pre>
<p>And then register that error renderer in the core error handler. In the example below we will register the renderer to be used for <code>text/html</code> content types.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">MyApp</span>\<span class="hljs-title">Handlers</span>\<span class="hljs-title">MyErrorHandler</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Slim</span>\<span class="hljs-title">Factory</span>\<span class="hljs-title">AppFactory</span>;

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&apos;/../vendor/autoload.php&apos;</span>;

$app = AppFactory::create();

<span class="hljs-comment">// Add Routing Middleware</span>
$app-&gt;addRoutingMiddleware();

<span class="hljs-comment">// Add Error Middleware</span>
$errorMiddleware = $app-&gt;addErrorMiddleware(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>);

<span class="hljs-comment">// Get the default error handler and register my custom error renderer.</span>
$errorHandler = $errorMiddleware-&gt;getDefaultErrorHandler();
$errorHandler-&gt;registerErrorRenderer(<span class="hljs-string">&apos;text/html&apos;</span>, MyCustomErrorRenderer::class);

<span class="hljs-comment">// ...</span>

$app-&gt;run();
</code></pre>
<h3 id="force-a-specific-content-type-for-error-rendering"><a name="force-a-specific-content-type-for-error-rendering" class="anchor-navigation-ex-anchor" href="#force-a-specific-content-type-for-error-rendering"><i class="fa fa-link" aria-hidden="true"></i></a><a name="force-a-specific-content-type-for-error-rendering" class="plugin-anchor" href="#force-a-specific-content-type-for-error-rendering"><i class="fa fa-link" aria-hidden="true"></i></a>Force a specific content type for error rendering</h3>
<p>By default, the error handler tries to detect the error renderer using the <code>Accept</code> header of the request. If you need to force the error handler to use a specific error renderer you can write the following.</p>
<pre><code class="lang-php">$errorHandler-&gt;forceContentType(<span class="hljs-string">&apos;application/json&apos;</span>);
</code></pre>
<h2 id="new-http-exceptions"><a name="new-http-exceptions" class="anchor-navigation-ex-anchor" href="#new-http-exceptions"><i class="fa fa-link" aria-hidden="true"></i></a><a name="new-http-exceptions" class="plugin-anchor" href="#new-http-exceptions"><i class="fa fa-link" aria-hidden="true"></i></a>New HTTP Exceptions</h2>
<p>We have added named HTTP exceptions within the application. These exceptions work nicely with the native renderers. They can each have a <code>description</code> and <code>title</code> attribute as well to provide a bit more insight when the native HTML renderer is invoked.</p>
<p>The base class <code>HttpSpecializedException</code> extends <code>Exception</code> and comes with the following sub classes:</p>
<ul>
<li>HttpBadRequestException</li>
<li>HttpForbiddenException</li>
<li>HttpInternalServerErrorException</li>
<li>HttpNotAllowedException</li>
<li>HttpNotFoundException</li>
<li>HttpNotImplementedException</li>
<li>HttpUnauthorizedException</li>
</ul>
<p>You can extend the <code>HttpSpecializedException</code> class if they need any other response codes that we decide not to provide with the base repository. Example if you wanted a 504 gateway timeout exception that behaves like the native ones you would do the following:</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpForbiddenException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpException</span>
</span>{
    <span class="hljs-keyword">protected</span> $code = <span class="hljs-number">504</span>;
    <span class="hljs-keyword">protected</span> $message = <span class="hljs-string">&apos;Gateway Timeout.&apos;</span>;
    <span class="hljs-keyword">protected</span> $title = <span class="hljs-string">&apos;504 Gateway Timeout&apos;</span>;
    <span class="hljs-keyword">protected</span> $description = <span class="hljs-string">&apos;Timed out before receiving response from the upstream server.&apos;</span>;
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="1-routing.html" class="navigation navigation-prev " aria-label="Previous page: Routing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="3-method-overriding.html" class="navigation navigation-next " aria-label="Next page: Method Overriding">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Error Handling","level":"1.8.2","depth":2,"next":{"title":"Method Overriding","level":"1.8.3","depth":2,"path":"7-packaged-middleware/3-method-overriding.md","ref":"7-packaged-middleware/3-method-overriding.md","articles":[]},"previous":{"title":"Routing","level":"1.8.1","depth":2,"path":"7-packaged-middleware/1-routing.md","ref":"7-packaged-middleware/1-routing.md","articles":[]},"dir":"ltr"},"config":{"plugins":["search-pro","-toggle-chapters","chapter-fold","expandable-chapters","-sharing","splitter","expandable-chapters-small","anchors","github","github-buttons","-donate","sharing-plus","anchor-navigation-ex","favicon","copy-code-button"],"ignores":["node_modules","_book"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"chapter-fold":{},"github":{"url":"https://github.com/nuxseme/slim-portal"},"splitter":{},"search-pro":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"alipay":"","title":"","button":"赞赏","alipayText":" "},"fontsettings":{"theme":"night","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":false},"favicon":{"shortcut":"assets/favicon.ico","bookmark":"assets/favicon.ico","appleTouch":"assets/favicon.ico","appleTouchMore":{"120x120":"assets/favicon.png","180x180":"assets/favicon.png"}},"github-buttons":{"buttons":[{"user":"nuxseme","repo":"slim-portal","type":"star","size":"small","count":true}]},"expandable-chapters-small":{},"copy-code-button":{},"sharing":{"qq":false,"all":["google","facebook","weibo","twitter","qq","qzone","linkedin","pocket"],"douban":false,"facebook":false,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":false,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{}},"theme":"default","author":"nuxseme","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"sortedBy":"-","disableTitleFormatting":false,"variables":{},"title":"Slim Portal","language":"zh-hans","catalog":"all","links":{"Github":{"Github":"https://github.com/nuxseme/slim-portal"}},"gitbook":"3.2.3","unchanged":[],"description":"Slim","outputfile":"SUMMARY.md"},"file":{"path":"7-packaged-middleware/2-error-handling.md","mtime":"2020-06-02T06:36:24.643Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-06-02T06:37:26.760Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

